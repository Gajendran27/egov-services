---
ReportDefinitions:
- reportName: UlbPtCollection
  summary: ULB PT Collection
  version: 1.0.0
  moduleName: rainmaker-pt
  sourceColumns:
  - name: day
    label: reports.pt.day
    type: string
    source: pt
    total: false
  - name: assessments
    label: reports.pt.assessments
    type: string
    source: pt
    total: true
  - name: assessmentAmount
    label: reports.pt.assessmentAmount
    type: string
    source: pt
    total: true
  - name: collectedAmount
    label: reports.pt.collectedAmount
    type: string
    source: pt
    total: true
  - name: ptCollected
    label: reports.pt.ptCollected
    type: string
    source: pt
    total: true
  - name: firecessCollected
    label: reports.pt.fireCessCollected
    type: string
    source: pt
    total: true
  - name: penaltiesCollected
    label: reports.pt.penaltiesCollected
    type: string
    source: pt
    total: true
  - name: interestCollected
    label: reports.pt.interestCollected
    type: string
    source: pt
    total: true
  - name: rebateGiven
    label: reports.pt.rebateGiven
    type: string
    source: pt
    total: true
  - name: exemptionGiven
    label: reports.pt.exemptionGiven
    type: string
    source: pt
    total: true
  - name: paymentDues
    label: reports.pt.paymentDues
    type: string
    source: pt
    total: true
  searchParams:
  - name: fromDate
    label: reports.pt.fromDate
    type: epoch
    source: pt
    isMandatory: false
    searchClause: AND createdtime >= $fromDate
  - name: toDate
    label: reports.pt.toDate
    type: epoch
    source: pt
    isMandatory: false
    searchClause: AND createdtime <= $toDate
  - name: zoneList
    label: reports.pt.zoneList
    type: boundarylist
    source: pt
    wrapper: true
    isMandatory: false
  query: SELECT COUNT(*)::VARCHAR as assessments, sum(taxamount)::VARCHAR AS assessmentAmount, sum(collectionamount)::VARCHAR AS collectedAmount, sum(CASE WHEN taxheadcode LIKE 'PT_TAX' THEN collectionamount ELSE 0 END) AS ptCollected, sum(CASE WHEN taxheadcode LIKE 'PT_FIRE_CESS' THEN collectionamount ELSE 0 END) as fireCessCollected, sum(CASE WHEN taxheadcode LIKE '%PENALTY%' THEN collectionamount ELSE 0 END) AS penaltiesCollected, sum(CASE WHEN taxheadcode LIKE '%INTEREST%' THEN collectionamount ELSE 0 END) AS interestCollected, sum(CASE WHEN taxheadcode LIKE '%REBATE%' THEN taxamount ELSE 0 END) AS rebateGiven, sum(CASE WHEN taxheadcode LIKE '%EXEMPTION%' THEN taxamount ELSE 0 END) AS exemptionGiven, sum(CASE WHEN taxheadcode LIKE '%LATE_PENALTY%' THEN taxamount ELSE 0 END) AS paymentDues, to_char(to_timestamp(TRUNC(CAST(createdtime AS bigint) / 1000)), 'DD/MM/YYYY') as day FROM egbs_demanddetail WHERE tenantid LIKE $tenantid
  groupby: GROUP BY day
  orderby: ORDER BY day DESC


- reportName: ReceiptRegister
  summary: Receipt Register
  version: 1.0.0
  moduleName: rainmaker-pt
  sourceColumns:
  - name: receiptnumber
    label: reports.pt.receiptNo
    type: string
    source: pt
    total: false
  - name: amount
    label: reports.pt.amount
    type: string
    source: pt
    total: true
  - name: instrumenttype
    label: reports.pt.paymentMode
    type: string
    source: pt
    total: false
  - name: transactionnumber
    label: reports.pt.ddChequeTransactionNo
    type: string
    source: pt
    total: false
  - name: transactiondate
    label: reports.pt.ddChequeTransactionDate
    type: string
    source: pt
    total: false
  searchParams:
  - name: fromDate
    label: reports.pt.fromDate
    type: epoch
    source: pt
    isMandatory: false
    searchClause: AND tbl_rcpt.createddate >= $fromDate
  - name: toDate
    label: reports.pt.toDate
    type: epoch
    source: pt
    isMandatory: false
    searchClause: AND tbl_rcpt.createddate <= $toDate
  - name: zoneList
    label: reports.pt.zoneList
    type: boundarylist
    source: pt
    isMandatory: false
  query: SELECT * FROM (SELECT consumercode, a.createddate, to_char(to_timestamp(a.createddate / 1000), 'DD/MM/YYYY') AS transactiondate, receiptnumber, amount, instrumenttype, transactionnumber FROM egcl_receiptheader AS a INNER JOIN egcl_receiptinstrument AS c ON a.id = c.receiptheader INNER JOIN egcl_instrumentheader AS b ON b.id = c.instrumentheader AND a.tenantid LIKE $tenantid) AS tbl_rcpt INNER JOIN (SELECT locality, CONCAT(a.property, ':', b.assessmentnumber) AS consumercode FROM eg_pt_address_v2 AS a INNER JOIN eg_pt_propertydetail_v2 AS b ON a.property = b.property WHERE locality IN ($localityArray)) AS tbl_lclty ON tbl_rcpt.consumercode = tbl_lclty.consumercode
  orderby: ORDER BY tbl_rcpt.createddate DESC