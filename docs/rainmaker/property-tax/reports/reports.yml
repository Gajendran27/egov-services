---
ReportDefinitions:
- reportName: UlbPtCollection
  summary: ULB PT Collection
  version: 1.0.0
  moduleName: rainmaker-pt
  sourceColumns:
  - name: day
    label: reports.pt.day
    type: string
    source: pt
    total: false
  - name: assessments
    label: reports.pt.assessments
    type: string
    source: pt
    total: true
  - name: assessmentAmount
    label: reports.pt.assessmentAmount
    type: string
    source: pt
    total: true
  - name: collectedAmount
    label: reports.pt.collectedAmount
    type: string
    source: pt
    total: true
  - name: ptCollected
    label: reports.pt.ptCollected
    type: string
    source: pt
    total: true
  - name: firecessCollected
    label: reports.pt.fireCessCollected
    type: string
    source: pt
    total: true
  - name: penaltiesCollected
    label: reports.pt.penaltiesCollected
    type: string
    source: pt
    total: true
  - name: interestCollected
    label: reports.pt.interestCollected
    type: string
    source: pt
    total: true
  - name: rebateGiven
    label: reports.pt.rebateGiven
    type: string
    source: pt
    total: true
  - name: exemptionGiven
    label: reports.pt.exemptionGiven
    type: string
    source: pt
    total: true
  - name: paymentDues
    label: reports.pt.paymentDues
    type: string
    source: pt
    total: true
  searchParams:
  - name: fromDate
    label: reports.pt.fromDate
    type: epoch
    source: pt
    isMandatory: false
    searchClause: AND createdtime >= $fromDate
  - name: toDate
    label: reports.pt.toDate
    type: epoch
    source: pt
    isMandatory: false
    searchClause: AND createdtime <= $toDate
  - name: zoneList
    label: reports.pt.zoneList
    type: boundarylist
    source: pt
    wrapper: true
    isMandatory: false
  query: SELECT COUNT(*)::VARCHAR as assessments, sum(taxamount)::VARCHAR AS assessmentAmount, sum(collectionamount)::VARCHAR AS collectedAmount, sum(CASE WHEN taxheadcode LIKE 'PT_TAX' THEN collectionamount ELSE 0 END) AS ptCollected, sum(CASE WHEN taxheadcode LIKE 'PT_FIRE_CESS' THEN collectionamount ELSE 0 END) as fireCessCollected, sum(CASE WHEN taxheadcode LIKE '%PENALTY%' THEN collectionamount ELSE 0 END) AS penaltiesCollected, sum(CASE WHEN taxheadcode LIKE '%INTEREST%' THEN collectionamount ELSE 0 END) AS interestCollected, sum(CASE WHEN taxheadcode LIKE '%REBATE%' THEN taxamount ELSE 0 END) AS rebateGiven, sum(CASE WHEN taxheadcode LIKE '%EXEMPTION%' THEN taxamount ELSE 0 END) AS exemptionGiven, sum(CASE WHEN taxheadcode LIKE '%LATE_PENALTY%' THEN taxamount ELSE 0 END) AS paymentDues, to_char(to_timestamp(TRUNC(CAST(createdtime AS bigint) / 1000)), 'DD/MM/YYYY') as day FROM egbs_demanddetail WHERE tenantid LIKE $tenantid
  groupby: GROUP BY day
  orderby: ORDER BY day DESC


- reportName: ReceiptRegister
  summary: Receipt Register
  version: 1.0.0
  moduleName: rainmaker-pt
  sourceColumns:
  - name: receiptnumber
    label: reports.pt.receiptNo
    type: string
    source: pt
    total: false
  - name: transactiondate
    label: reports.pt.receiptDate
    type: string
    source: pt
    total: false
  - name: amount
    label: reports.pt.amount
    type: string
    source: pt
    total: true
  - name: propertytax
    label: reports.pt.propertyTax
    type: string
    source: pt
    total: true
  - name: firecess
    label: reports.pt.fireCess
    type: string
    source: pt
    total: true
  - name: cancercess
    label: reports.pt.cancerCess
    type: string
    source: pt
    total: true
  - name: assessmentnumber
    label: reports.pt.assessmentNo
    type: string
    source: pt
    total: false
  - name: financialyear
    label: reports.pt.financialYear
    type: string
    source: pt
    total: false
  - name: instrumenttype
    label: reports.pt.paymentMode
    type: string
    source: pt
    total: false
  - name: transactionnumber
    label: reports.pt.ddChequeTransactionNo
    type: string
    source: pt
    total: false
  - name: bankname
    label: reports.pt.bankName
    type: string
    source: pt
    total: false
  searchParams:
  - name: fromDate
    label: reports.pt.fromDate
    type: epoch
    source: pt
    isMandatory: false
    searchClause: AND tbl_rcpt.createddate >= $fromDate
  - name: toDate
    label: reports.pt.toDate
    type: epoch
    source: pt
    isMandatory: false
    searchClause: AND tbl_rcpt.createddate <= $toDate
  - name: paymentMode
    label: reports.pt.paymentMode
    type: singlevaluelist
    pattern: 'list://Cash:Cash,Online:Online,Card:Card,DD:DD,Cheque:Cheque'
    source: pt
    isMandatory: false
    searchClause: AND instrumenttype = $paymentMode
  - name: financialyear
    label: reports.pt.financialYear
    type: singlevaluelist
    pattern: http://egov-mdms-service:8080/egov-mdms-service/v1/_get?tenantId=$tenantid&moduleName=egf-master&masterName=FinancialYear|$.MdmsRes.egf-master.FinancialYear.[?(@.module=='PT')].code|$.MdmsRes.egf-master.FinancialYear.[?(@.module=='PT')].name
    source: pt
    wrapper: true
    isMandatory: false
    searchClause: AND financialyear = $financialyear
  - name: localityArray
    label: reports.pt.zoneList
    type: boundarylist
    source: pt
    isMandatory: false
    searchClause: AND locality IN ($localityArray)
  query: SELECT * FROM (SELECT * FROM (SELECT a.tenantid AS tenantid, a.id, SUBSTRING(a.consumercode, ':(.*)') AS assessmentnumber, a.consumercode, a.createddate, to_char(to_timestamp(a.createddate / 1000), 'DD/MM/YYYY') AS transactiondate, bankid AS bankname, receiptnumber, amount, instrumenttype, transactionnumber FROM egcl_receiptheader AS a LEFT OUTER JOIN egcl_receiptinstrument AS c ON a.id = c.receiptheader LEFT OUTER JOIN egcl_instrumentheader AS b ON b.id = c.instrumentheader) AS aa LEFT OUTER JOIN (SELECT aaa.receiptheader, firecess, cancercess, propertytax FROM (SELECT SUM(cramount) AS firecess, receiptheader FROM egcl_receiptdetails WHERE description LIKE 'PT_FIRE_CESS%' GROUP BY receiptheader) AS aaa FULL OUTER JOIN (SELECT SUM(cramount) AS cancercess, receiptheader FROM egcl_receiptdetails WHERE description LIKE 'PT_CANCER_CESS%' GROUP BY receiptheader) AS bbb ON aaa.receiptheader = bbb.receiptheader FULL OUTER JOIN (SELECT SUM(cramount) AS propertytax, receiptheader FROM egcl_receiptdetails WHERE description LIKE 'PT_TAX%' GROUP BY receiptheader) AS ccc ON aaa.receiptheader = ccc.receiptheader) AS bb ON aa.id = bb.receiptheader) AS tbl_rcpt LEFT OUTER JOIN (SELECT financialyear, locality, CONCAT(aa.property, ':', bb.assessmentnumber) AS consumercode FROM eg_pt_address_v2 AS aa RIGHT OUTER JOIN eg_pt_propertydetail_v2 AS bb ON aa.property = bb.property) AS tbl_lclty ON tbl_rcpt.consumercode = tbl_lclty.consumercode WHERE tenantid LIKE $tenantid
  orderby: ORDER BY tbl_rcpt.createddate DESC


- reportName: UlbWisePtCollection
  summary: ULB-wise PT Collection
  version: 1.0.0
  moduleName: rainmaker-pt
  sourceColumns:
  - name: receiptnumber
    label: reports.pt.receiptNo
    type: string
    source: pt
    total: false
  searchParams:
  - name: fromDate
    label: reports.pt.fromDate
    type: epoch
    source: pt
    isMandatory: false
    searchClause: AND tbl_rcpt.createddate >= $fromDate
  - name: toDate
    label: reports.pt.toDate
    type: epoch
    source: pt
    isMandatory: false
    searchClause: AND tbl_rcpt.createddate <= $toDate
  query: